version: '2' # specify docker-compose version

# Define the services/containers to be run
services:
  angularjs: # name of the first service
    container_name: angularjs
    build:
      context: . # specify the directory of the Dockerfile
      dockerfile: ./.docker/docker-angularjs.dockerfile
    ports:
      - "3000:3000" # specify port forewarding
    volumes:
      - ./blur-admin/src:/app/src
    depends_on: 
      - nginx
    networks:
      - nectarApp-network

  nginx:
    container_name: nginx
    build:
      context: . # specify the directory of the Dockerfile
      dockerfile: ./.docker/docker-nginx.dockerfile
    volumes:
      - ./.docker/config/nginx.conf:/etc/nginx/nginx.conf
    links:
        - node1:node1
        - node2:node2
    ports:
        - "80:80"
    depends_on: 
      - node1
      - node2
    networks:
      - nectarApp-network

  node1: #name of the second service
    container_name: node1
    build:
      context: . # specify the directory of the Dockerfile
      dockerfile: ./.docker/docker-node.dockerfile
    volumes:
      - ./crypto-exchange-api/:/app/
    env_file:
      - ./.docker/env/node.${APP_ENV}.env
    ports:
      - "9000:9000" #specify ports forewarding
    depends_on: 
      - mongodb
    networks:
      - nectarApp-network

  node2: #name of the second service
    container_name: node2
    build:
      context: . # specify the directory of the Dockerfile
      dockerfile: ./.docker/docker-node.dockerfile
    volumes:
      - ./crypto-exchange-api/:/app/
    env_file:
      - ./.docker/env/node.${APP_ENV}.env
    ports:
      - "9001:9000" #specify ports forewarding
    depends_on: 
      - mongodb
    networks:
      - nectarApp-network

  mongodb:
    container_name: mongodb
    image: mongo
    volumes:
      - "./data/db:/data/db"
      - "./data/configdb:/data/configdb"
    ports:
      - "27017:27017"
    env_file:
      - ./.docker/env/mongo.${APP_ENV}.env
    networks:
      - nectarApp-network

networks:
  nectarApp-network:
    driver: bridge